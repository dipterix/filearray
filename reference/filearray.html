<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create or load existing file arrays — filearray • filearray</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create or load existing file arrays — filearray"><meta property="og:description" content="Create or load existing file arrays"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">filearray</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/performance.html">Performance Comparisons - (Numerical)</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dipterix/filearray/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create or load existing file arrays</h1>
    <small class="dont-index">Source: <a href="https://github.com/dipterix/filearray/blob/HEAD/R/load.R" class="external-link"><code>R/load.R</code></a></small>
    <div class="hidden name"><code>filearray.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Create or load existing file arrays</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">filearray_create</span><span class="op">(</span></span>
<span>  <span class="va">filebase</span>,</span>
<span>  <span class="va">dimension</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="st">"float"</span>, <span class="st">"integer"</span>, <span class="st">"logical"</span>, <span class="st">"raw"</span>, <span class="st">"complex"</span><span class="op">)</span>,</span>
<span>  partition_size <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  initialize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">filearray_load</span><span class="op">(</span><span class="va">filebase</span>, mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"readwrite"</span>, <span class="st">"readonly"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">filearray_checkload</span><span class="op">(</span></span>
<span>  <span class="va">filebase</span>,</span>
<span>  mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"readonly"</span>, <span class="st">"readwrite"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  symlink_ok <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>filebase</dt>
<dd><p>a directory path to store arrays in the local file 
system. When creating an array, the path must not exist.</p></dd>


<dt>dimension</dt>
<dd><p>dimension of the array, at least length of 2</p></dd>


<dt>type</dt>
<dd><p>storage type of the array; default is <code>'double'</code>. Other
options include <code>'integer'</code>, <code>'logical'</code>, and <code>'raw'</code>.</p></dd>


<dt>partition_size</dt>
<dd><p>positive partition size for the last margin, or
<code>NA</code> to automatically guess; see 'Details'.</p></dd>


<dt>initialize</dt>
<dd><p>whether to initialize partition files; default is false
for performance considerations. However, if the array is dense, it is 
recommended to set to true</p></dd>


<dt>...</dt>
<dd><p>additional headers to check used by <code>filearray_checkload</code>
(see 'Details'). This argument is ignored by <code>filearray_create</code>, 
reserved for future compatibility.</p></dd>


<dt>mode</dt>
<dd><p>whether allows writing to the file; choices are 
<code>'readwrite'</code> and <code>'readonly'</code>.</p></dd>


<dt>symlink_ok</dt>
<dd><p>whether arrays with symbolic-link partitions can pass 
the test; this is usually used on bound arrays with symbolic-links; see 
<code><a href="filearray_bind.html">filearray_bind</a></code>;</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <code><a href="FileArray-class.html">FileArray-class</a></code> instance.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The file arrays partition out-of-memory array objects and store them 
separately in local file systems. Since R stores matrices/arrays 
in column-major style, file array uses the slowest margin (the 
last margin) to slice the partitions. This helps to align the elements
within the files with the corresponding memory order. An array with 
dimension <code>100x200x300x400</code> has 4 margins. The length of the 
last margin is 400, which is also the maximum number of potential
partitions. The number of partitions are determined by the last margin
size divided by <code>partition_size</code>. For example, if the partition
size is 1, then there will be 400 partitions. If the partition size 
if 3, there will be 134 partitions. The default partition sizes 
are determined internally following these priorities:</p><dl><dt>1. </dt>
<dd><p>the file size of each partition does not exceed <code>1GB</code></p></dd>

<dt>2. </dt>
<dd><p>the number of partitions do not exceed 100</p></dd>


</dl><p>These two rules are not hard requirements. The goal is to reduce the
numbers of partitions as much as possible.</p>
<p>The arguments <code>...</code> in <code>filearray_checkload</code> should be named
arguments that provide additional checks for the header information. 
The check will fail if at least one header is not identical. For example,
if an array contains header key-signature pair, one can use 
<code>filearray_checkload(..., key = signature)</code> to validate the signature.
Note the comparison will be rigid, meaning the storage type of the headers 
will be considered as well. If the signature stored in the array is an 
integer while provided is a double, then the check will result in failure.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Zhengjia Wang</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Prepare </span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://dipterix.org/filearray/">filearray</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">filebase</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">filebase</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">filebase</span>, <span class="cn">TRUE</span><span class="op">)</span> <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create array</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">filearray_create</span><span class="op">(</span><span class="va">filebase</span>, dimension <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">30</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reference class object of class "FileArray"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mode: readwrite </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension: 200x30x8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # of partitions: 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Partition size: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Storage type: double (internal size: 8)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location: /tmp/Rtmpdq3As3/file367154ca1b62 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assign values</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">48000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Subset</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -0.55643113 -0.94698321 -0.07392371 -1.81383310  0.98230328  0.13706912</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7]  0.15188031  0.31397965</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load existing array</span></span></span>
<span class="r-in"><span><span class="fu">filearray_load</span><span class="op">(</span><span class="va">filebase</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reference class object of class "FileArray"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mode: readwrite </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension: 200x30x8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # of partitions: 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Partition size: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Storage type: double (internal size: 8)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location: /tmp/Rtmpdq3As3/file367154ca1b62 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">$</span><span class="fu">set_header</span><span class="op">(</span><span class="st">"signature"</span>, <span class="st">"tom"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">filearray_checkload</span><span class="op">(</span><span class="va">filebase</span>, signature <span class="op">=</span> <span class="st">"tom"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reference class object of class "FileArray"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mode: readonly </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension: 200x30x8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # of partitions: 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Partition size: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Storage type: double (internal size: 8)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location: /tmp/Rtmpdq3As3/file367154ca1b62 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Trying to load with wrong signature</span></span></span>
<span class="r-in"><span><span class="fu">filearray_checkload</span><span class="op">(</span><span class="va">filebase</span>, signature <span class="op">=</span> <span class="st">"jerry"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Zhengjia Wang.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

