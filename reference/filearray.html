<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create or load existing file arrays — as_filearray • filearray</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create or load existing file arrays — as_filearray"><meta name="description" content="Create or load existing file arrays"><meta property="og:description" content="Create or load existing file arrays"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">filearray</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/performance.html">Performance Comparisons - (Numerical)</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dipterix/filearray/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create or load existing file arrays</h1>
      <small class="dont-index">Source: <a href="https://github.com/dipterix/filearray/blob/main/R/class-filearray.R" class="external-link"><code>R/class-filearray.R</code></a>, <a href="https://github.com/dipterix/filearray/blob/main/R/class-proxy.R" class="external-link"><code>R/class-proxy.R</code></a>, <a href="https://github.com/dipterix/filearray/blob/main/R/load.R" class="external-link"><code>R/load.R</code></a></small>
      <div class="d-none name"><code>filearray.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create or load existing file arrays</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">as_filearray</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">as_filearrayproxy</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">filearray_create</span><span class="op">(</span></span>
<span>  <span class="va">filebase</span>,</span>
<span>  <span class="va">dimension</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="st">"float"</span>, <span class="st">"integer"</span>, <span class="st">"logical"</span>, <span class="st">"raw"</span>, <span class="st">"complex"</span><span class="op">)</span>,</span>
<span>  partition_size <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  initialize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">filearray_load</span><span class="op">(</span><span class="va">filebase</span>, mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"readwrite"</span>, <span class="st">"readonly"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">filearray_checkload</span><span class="op">(</span></span>
<span>  <span class="va">filebase</span>,</span>
<span>  mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"readonly"</span>, <span class="st">"readwrite"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  symlink_ok <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">filearray_load_or_create</span><span class="op">(</span></span>
<span>  <span class="va">filebase</span>,</span>
<span>  <span class="va">dimension</span>,</span>
<span>  on_missing <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"readonly"</span>, <span class="st">"readwrite"</span><span class="op">)</span>,</span>
<span>  symlink_ok <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  initialize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  partition_size <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>R object such as array, file array proxy, or character that can be
transformed into file array</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional headers to check used by <code>filearray_checkload</code>
(see 'Details'). This argument is ignored by <code>filearray_create</code>,
reserved for future compatibility.</p></dd>


<dt id="arg-filebase">filebase<a class="anchor" aria-label="anchor" href="#arg-filebase"></a></dt>
<dd><p>a directory path to store arrays in the local file
system. When creating an array, the path must not exist.</p></dd>


<dt id="arg-dimension">dimension<a class="anchor" aria-label="anchor" href="#arg-dimension"></a></dt>
<dd><p>dimension of the array, at least length of 2</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>storage type of the array; default is <code>'double'</code>. Other
options include <code>'integer'</code>, <code>'logical'</code>, and <code>'raw'</code>.</p></dd>


<dt id="arg-partition-size">partition_size<a class="anchor" aria-label="anchor" href="#arg-partition-size"></a></dt>
<dd><p>positive partition size for the last margin, or
<code>NA</code> to automatically guess; see 'Details'.</p></dd>


<dt id="arg-initialize">initialize<a class="anchor" aria-label="anchor" href="#arg-initialize"></a></dt>
<dd><p>whether to initialize partition files; default is false
for performance considerations. However, if the array is dense, it is
recommended to set to true</p></dd>


<dt id="arg-mode">mode<a class="anchor" aria-label="anchor" href="#arg-mode"></a></dt>
<dd><p>whether allows writing to the file; choices are
<code>'readwrite'</code> and <code>'readonly'</code>.</p></dd>


<dt id="arg-symlink-ok">symlink_ok<a class="anchor" aria-label="anchor" href="#arg-symlink-ok"></a></dt>
<dd><p>whether arrays with symbolic-link partitions can pass
the test; this is usually used on bound arrays with symbolic-links; see
<code><a href="filearray_bind.html">filearray_bind</a></code>;</p></dd>


<dt id="arg-on-missing">on_missing<a class="anchor" aria-label="anchor" href="#arg-on-missing"></a></dt>
<dd><p>function to handle file array (such as initialization)
when a new array is created; must take only one argument, the array object</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>whether to print out some debug messages</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code><a href="FileArray-class.html">FileArray-class</a></code> instance.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The file arrays partition out-of-memory array objects and store them
separately in local file systems. Since R stores matrices/arrays
in column-major style, file array uses the slowest margin (the
last margin) to slice the partitions. This helps to align the elements
within the files with the corresponding memory order. An array with
dimension <code>100x200x300x400</code> has 4 margins. The length of the
last margin is 400, which is also the maximum number of potential
partitions. The number of partitions are determined by the last margin
size divided by <code>partition_size</code>. For example, if the partition
size is 1, then there will be 400 partitions. If the partition size
if 3, there will be 134 partitions. The default partition sizes
are determined internally following these priorities:</p><dl><dt>1. </dt>
<dd><p>the file size of each partition does not exceed <code>1GB</code></p></dd>

<dt>2. </dt>
<dd><p>the number of partitions do not exceed 100</p></dd>


</dl><p>These two rules are not hard requirements. The goal is to reduce the
numbers of partitions as much as possible.</p>
<p>The arguments <code>...</code> in <code>filearray_checkload</code> should be named
arguments that provide additional checks for the header information.
The check will fail if at least one header is not identical. For example,
if an array contains header key-signature pair, one can use
<code>filearray_checkload(..., key = signature)</code> to validate the signature.
Note the comparison will be rigid, meaning the storage type of the headers
will be considered as well. If the signature stored in the array is an
integer while provided is a double, then the check will result in failure.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Zhengjia Wang</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Prepare</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dipterix.org/filearray/">filearray</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">filebase</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">filebase</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">filebase</span>, <span class="cn">TRUE</span><span class="op">)</span> <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create array</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">filearray_create</span><span class="op">(</span><span class="va">filebase</span>, dimension <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">30</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reference class object of class "FileArray"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mode: readwrite </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension: 200x30x8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Partition count: 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Partition size: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Storage type: double (internal size: 8)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location: /tmp/RtmpoasBrb/file168b42da8fcc </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assign values</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">48000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Subset</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -0.42938009  0.44742147  1.05363668 -0.97346749 -0.09327726 -1.14067120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7]  1.45111737  0.47259544</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load existing array</span></span></span>
<span class="r-in"><span><span class="fu">filearray_load</span><span class="op">(</span><span class="va">filebase</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reference class object of class "FileArray"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mode: readwrite </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension: 200x30x8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Partition count: 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Partition size: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Storage type: double (internal size: 8)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location: /tmp/RtmpoasBrb/file168b42da8fcc </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">$</span><span class="fu">set_header</span><span class="op">(</span><span class="st">"signature"</span>, <span class="st">"tom"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">filearray_checkload</span><span class="op">(</span><span class="va">filebase</span>, signature <span class="op">=</span> <span class="st">"tom"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reference class object of class "FileArray"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mode: readonly </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension: 200x30x8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Partition count: 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Partition size: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Storage type: double (internal size: 8)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location: /tmp/RtmpoasBrb/file168b42da8fcc </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Trying to load with wrong signature</span></span></span>
<span class="r-in"><span><span class="fu">filearray_checkload</span><span class="op">(</span><span class="va">filebase</span>, signature <span class="op">=</span> <span class="st">"jerry"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check-load, and create a new array if fail</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">filearray_load_or_create</span><span class="op">(</span></span></span>
<span class="r-in"><span>    filebase <span class="op">=</span> <span class="va">filebase</span>, dimension <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">30</span>, <span class="fl">8</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    verbose <span class="op">=</span> <span class="cn">FALSE</span>, signature <span class="op">=</span> <span class="st">"henry"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">$</span><span class="fu">get_header</span><span class="op">(</span><span class="st">"signature"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "henry"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check-load with initialization</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">filearray_load_or_create</span><span class="op">(</span></span></span>
<span class="r-in"><span>    filebase <span class="op">=</span> <span class="va">filebase</span>,</span></span>
<span class="r-in"><span>    dimension <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    verbose <span class="op">=</span> <span class="cn">FALSE</span>, mode <span class="op">=</span> <span class="st">"readonly"</span>,</span></span>
<span class="r-in"><span>    on_missing <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">array</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">array</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">60</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Clean up</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">filebase</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhengjia Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

